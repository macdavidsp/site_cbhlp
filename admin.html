<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel Administrativo</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Painel Administrativo</h1>
    <nav>
      <ul>
        <li><a href="index.html">Início</a></li>
        <li><a href="cadastro.html">Registro</a></li>
        <li><a href="verificar.html">Verificação</a></li>
        <li><a href="quorum.html">Quórum</a></li>
        <li><a href="admin.html">Admin</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <div id="loginArea">
      <input type="password" id="senha" placeholder="Digite a senha de admin" />
      <button onclick="verificarSenha()">Entrar</button>
    </div>
    <p id="status" style="display:none;"></p>
    <table id="tabelaPresencas" style="display:none;">
      <thead>
        <tr>
          <th>Nome</th>
          <th>CPF</th>
          <th>Instituição</th>
          <th>Setor</th>
          <th>Representação</th>
          <th>Código</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <script>
    const tabela = document.querySelector("#tabelaPresencas tbody");
    const status = document.getElementById("status");
    const tabelaPresencas = document.getElementById("tabelaPresencas");
    const loginArea = document.getElementById("loginArea");
    const API_URL = "https://script.google.com/macros/s/AKfycbwxsGyjekkgQx-OZbSrAufOYiSCPCWBFmlBS2GhnzP78I2EQCkJu9LPmbl3cWVO64jBSw/exec";

    function verificarSenha() {
      const senha = document.getElementById("senha").value.trim();
      const senhaCorreta = "cbhlp2025";

      if (senha === senhaCorreta) {
        loginArea.style.display = "none";
        status.style.display = "block";
        tabelaPresencas.style.display = "table";
        carregarPresencas();
      } else {
        alert("Senha incorreta. Acesso negado.");
      }
    }

    async function carregarPresencas() {
      try {
        const res = await fetch(API_URL);
        const dados = await res.json();
        const hoje = new Date().toISOString().split("T")[0];
        const presencasHoje = dados.filter(p => p[0] === hoje);

        if (presencasHoje.length === 0) {
          status.textContent = "⚠️ Nenhuma presença registrada hoje.";
          status.style.color = "orange";
          return;
        }

        presencasHoje.forEach(p => {
          const linha = document.createElement("tr");
          linha.innerHTML = `
            <td>${p[1]}</td>
            <td>${p[2]}</td>
            <td>${p[3]}</td>
            <td>${p[4]}</td>
            <td>${p[5]}</td>
            <td>${p[6]}</td>
          `;
          tabela.appendChild(linha);
        });

        status.textContent = `✅ Total de presenças hoje: ${presencasHoje.length}`;
        status.style.color = "green";
      } catch (err) {
        status.textContent = "❌ Erro ao carregar os dados.";
        status.style.color = "red";
      }
    }
  </script>
</body>
</html>