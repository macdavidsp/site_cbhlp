<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Administração</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Painel Administrativo</h1>
    <nav>
      <ul>
        <li><a href="index.html">Início</a></li>
        <li><a href="cadastro.html">Registro</a></li>
        <li><a href="verificar.html">Verificação</a></li>
        <li><a href="quorum.html">Quórum</a></li>
        <li><a href="admin.html">Admin</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <div id="loginArea">
      <h2>Login do Administrador</h2>
      <form id="loginForm">
        <input type="text" name="usuario" placeholder="Usuário" required />
        <input type="password" name="senha" placeholder="Senha" required />
        <button type="submit">Entrar</button>
      </form>
      <p id="loginMensagem"></p>
    </div>

    <div id="adminArea" style="display:none;">
      <h2>Presenças registradas</h2>
      <ul id="listaPresencas"></ul>
      <button onclick="exportarCSV()">Exportar CSV</button>
      <button onclick="exportarPDF()">Exportar PDF</button>
    </div>
  </main>

  <script>
    const loginForm = document.getElementById("loginForm");
    const loginMensagem = document.getElementById("loginMensagem");
    const loginArea = document.getElementById("loginArea");
    const adminArea = document.getElementById("adminArea");
    const listaPresencas = document.getElementById("listaPresencas");
    let presencas = [];

    loginForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const dados = Object.fromEntries(new FormData(this));
      if (dados.usuario === "admin" && dados.senha === "cbhlp2025") {
        loginArea.style.display = "none";
        adminArea.style.display = "block";
        carregarPresencas();
      } else {
        loginMensagem.textContent = "Usuário ou senha incorretos.";
        loginMensagem.style.color = "red";
      }
    });

    async function carregarPresencas() {
      const resposta = await fetch("https://script.google.com/macros/s/AKfycbxlxiuVdashA7ScizB1NuTzIYhVpDu-dkB4GBEnY6lQxiaqQy7IwD_f756KwoOGKkG_/exec");
      const dados = await resposta.json();
      presencas = dados.slice(1); // ignora cabeçalho
      listaPresencas.innerHTML = presencas.map(p =>
        `<li>${p[1]} (${p[3]}) - ${p[4]} / ${p[5]}</li>`
      ).join("");
    }

    function exportarCSV() {
      if (presencas.length === 0) return alert("Nenhuma presença registrada.");
      const cabecalho = ["Data", "Nome", "CPF", "Instituição", "Setor", "Representação", "Código"];
      const linhas = presencas.map(p => p.join(","));
      const csv = [cabecalho.join(","), ...linhas].join("\n");
      const blob = new Blob([csv], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "presencas.csv";
      link.click();
    }

    function exportarPDF() {
      if (presencas.length === 0) return alert("Nenhuma presença registrada.");
      const janela = window.open("", "", "width=800,height=600");
      janela.document.write("<h1>Lista de Presença</h1><ul>");
      presencas.forEach(p => {
        janela.document.write(`<li>${p[1]} (${p[3]}) - ${p[4]} / ${p[5]}</li>`);
      });
      janela.document.write("</ul>");
      janela.document.close();
      janela.print();
    }
  </script>
</body>
</html>