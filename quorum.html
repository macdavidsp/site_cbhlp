<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Quórum por Setor</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Quórum por Setor</h1>
    <nav>
      <ul>
        <li><a href="index.html">Início</a></li>
        <li><a href="cadastro.html">Registro</a></li>
        <li><a href="verificar.html">Verificação</a></li>
        <li><a href="quorum.html">Quórum</a></li>
        <li><a href="admin.html">Admin</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <p id="status">⏳ Calculando quórum...</p>
    <table id="tabelaQuorum">
      <thead>
        <tr>
          <th>Setor</th>
          <th>Titulares</th>
          <th>Suplentes</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <script>
    const tabela = document.querySelector("#tabelaQuorum tbody");
    const status = document.getElementById("status");
    const API_URL = "https://script.google.com/macros/s/AKfycbwxsGyjekkgQx-OZbSrAufOYiSCPCWBFmlBS2GhnzP78I2EQCkJu9LPmbl3cWVO64jBSw/exec";

    async function calcularQuorum() {
      try {
        const res = await fetch(API_URL);
        const dados = await res.json();
        const hoje = new Date().toISOString().split("T")[0];
        const presencasHoje = dados.filter(p => p[0] === hoje);

        if (presencasHoje.length === 0) {
          status.textContent = "⚠️ Nenhuma presença registrada hoje.";
          status.style.color = "orange";
          return;
        }

        const setores = ["Usuário", "Sociedade Civil", "Poder Público"];
        const contagem = {};

        setores.forEach(setor => {
          contagem[setor] = { Titular: 0, Suplente: 0 };
        });

        presencasHoje.forEach(p => {
          const setor = p[4];
          const representacao = p[5];
          if (contagem[setor] && contagem[setor][representacao] !== undefined) {
            contagem[setor][representacao]++;
          }
        });

        setores.forEach(setor => {
          const t = contagem[setor].Titular;
          const s = contagem[setor].Suplente;
          const linha = document.createElement("tr");
          linha.innerHTML = `
            <td>${setor}</td>
            <td>${t}</td>
            <td>${s}</td>
            <td>${t + s}</td>
          `;
          tabela.appendChild(linha);
        });

        const total = presencasHoje.length;
        status.textContent = `✅ Total de presentes hoje: ${total}`;
        status.style.color = "green";
      } catch (err) {
        status.textContent = "❌ Erro ao calcular o quórum.";
        status.style.color = "red";
      }
    }

    calcularQuorum();
  </script>
</body>
</html>