<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Quórum da Reunião</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="supabase.js"></script>
</head>
<body>
  <header>
    <h1>Quórum da Reunião</h1>
    <nav>
      <ul>
        <li><a href="index.html">Início</a></li>
        <li><a href="cadastro.html">Registro</a></li>
        <li><a href="verificar.html">Verificação</a></li>
        <li><a href="quorum.html">Quórum</a></li>
        <li><a href="admin.html">Admin</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <h2>Presenças registradas</h2>
    <canvas id="graficoQuorum" width="400" height="200"></canvas>
    <p id="statusQuorum"></p>
  </main>

  <script>
    async function getReuniaoAtiva() {
      const { data } = await supabase
        .from("reunioes")
        .select("data_reuniao")
        .eq("ativa", true)
        .single();
      return data?.data_reuniao || null;
    }

    async function contarPresencas(dataReuniao) {
      const { data } = await supabase
        .from("presencas")
        .select("id")
        .eq("data_reuniao", dataReuniao);
      return data.length;
    }

    async function gerarGrafico() {
      const dataReuniao = await getReuniaoAtiva();
      const total = await contarPresencas(dataReuniao);
      const ctx = document.getElementById("graficoQuorum").getContext("2d");

      new Chart(ctx, {
        type: "bar",
        data: {
          labels: ["Presenças", "Quórum mínimo"],
          datasets: [{
            label: "Participantes",
            data: [total, 15],
            backgroundColor: ["#004d99", "#999"]
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true }
          }
        }
      });

      const status = document.getElementById("statusQuorum");
      status.textContent = total >= 15
        ? "✅ Quórum atingido!"
        : `⚠️ Apenas ${total} participantes. Quórum mínimo é 15.`;
    }

    gerarGrafico();
  </script>
</body>
</html>